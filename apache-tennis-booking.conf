# Apache Configuration for Tennis Booking Application
# This configuration forwards all requests to the Flask app running on localhost:5001

<VirtualHost *:80>
    ServerName tennis-booking.local
    ServerAdmin admin@tennis-booking.local

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/tennis-booking-error.log
    CustomLog ${APACHE_LOG_DIR}/tennis-booking-access.log combined

    # Enable proxy modules (ensure these are enabled: a2enmod proxy proxy_http headers)
    ProxyPreserveHost On
    ProxyRequests Off

    # Set headers for reverse proxy
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"

    # Main application proxy - forward all requests to Flask app
    ProxyPass / http://localhost:5001/
    ProxyPassReverse / http://localhost:5001/

    # Specific routes for chat functionality (redundant but explicit)
    ProxyPass /chat http://localhost:5001/chat
    ProxyPassReverse /chat http://localhost:5001/chat

    ProxyPass /api/chat http://localhost:5001/api/chat
    ProxyPassReverse /api/chat http://localhost:5001/api/chat

    # Static files handling (if needed in the future)
    # ProxyPass /static !
    # Alias /static /opt/Tennis_Booking/static

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Timeouts for long-running requests
    ProxyTimeout 120

    # Error handling
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
</VirtualHost>

# HTTPS Configuration (when SSL is available)
# <VirtualHost *:443>
#     ServerName tennis-booking.local
#     ServerAdmin admin@tennis-booking.local
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /path/to/certificate.crt
#     SSLCertificateKeyFile /path/to/private.key
#     # SSLCertificateChainFile /path/to/chain.crt
#
#     # Logging
#     ErrorLog ${APACHE_LOG_DIR}/tennis-booking-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/tennis-booking-ssl-access.log combined
#
#     # Enable proxy modules
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     # Set headers for reverse proxy
#     RequestHeader set X-Forwarded-Proto "https"
#     RequestHeader set X-Forwarded-Port "443"
#
#     # Main application proxy
#     ProxyPass / http://localhost:5001/
#     ProxyPassReverse / http://localhost:5001/
#
#     # Specific routes for chat functionality
#     ProxyPass /chat http://localhost:5001/chat
#     ProxyPassReverse /chat http://localhost:5001/chat
#
#     ProxyPass /api/chat http://localhost:5001/api/chat
#     ProxyPassReverse /api/chat http://localhost:5001/api/chat
#
#     # Security headers
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#
#     # Timeouts
#     ProxyTimeout 120
#
#     <Proxy *>
#         Order deny,allow
#         Allow from all
#     </Proxy>
# </VirtualHost>
